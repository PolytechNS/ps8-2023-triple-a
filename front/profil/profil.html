
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Profil de l'utilisateur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"/>

    <link rel="stylesheet" href="style.css" />
    <script src="profil.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com/%22%3E">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Montserrat:ital,wght@0,200;1,200&display=swap" rel="stylesheet">
  </head>


  <body>
    <header>
      <object type="text/html" data="header.html" style="width:100%; height:100%;"></object>
    </header>

    <div class="container">
      <div class="back">
        <h1 class="title">Bienvenue sur votre profil <span id="username"></span> !</h1>
        <h2 class="addFriends">Add/See friends:</h2>
        <button class="button" onclick="window.location.href='/friendsList/friendsList.html'">
          Voir mes amis
        </button>
        <h2 class="rank">Rank :</h2>
        <span id="rank"></span>
        <div id="recompense"></div>
        <h2 class="stats">Stats</h2>
        <p class="score">Score: <span id="score"></span></p>
        <p class="wins">Wins: <span id="wins"></span></p>
        <p class="losses">Losses: <span id="losses"></span></p>
        <p class="winrate">Win Rate: <span id="winrate"></span></p>
        <h2 class="globalRank">Global Rank: </h2>
        <div id="ranking-container"></div>
        
      </div>
    </div>
    <script>
      const localHost = 'localhost';
const url = '15.236.164.81';
let localHostOrUrl = url;

  async function getData(event) {
    event.preventDefault();
    const token = localStorage.getItem("token");
    const response = await fetch(`http://${localHostOrUrl}:8000/api/online/data/${token}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ token: token }),
    });

    if (response.status === 200) {
      const data = await response.json();
      console.log(data);
      console.log("the user name is :", data.data.username);
      document.getElementById("username").innerText = data.data.username;
      document.getElementById("score").innerText = data.data.score;
      document.getElementById("wins").innerText = data.data.wins;
      document.getElementById("losses").innerText = data.data.totalGames - data.data.wins;
      document.getElementById("winrate").innerText = `${(
        (data.data.wins / data.data.totalGames) *
        100
      ).toFixed(2)}%`;

      const recompense = document.getElementById("recompense");
      const scoreText = document.getElementById("score").innerText;
      const scoreNumber = parseInt(scoreText);

      if (scoreNumber > 200) {
        const img = document.createElement("img");
        img.src = "gold-removebg-preview.png";
        img.alt = "Médaille d'or";
        document.getElementById("rank").innerText = "Gold";
        recompense.appendChild(img);
      } else if (scoreNumber >= 100 && scoreNumber <= 200) {
        const img = document.createElement("img");
        img.src = "silver-removebg-preview.png";
        img.alt = "Médaille d'argent";
        document.getElementById("rank").innerText = "Silver";
        recompense.appendChild(img);
      } else if (scoreNumber < 100 && scoreNumber>0) {
        const img = document.createElement("img");
        img.src = "bronze-removebg-preview.png";
        img.alt = "Médaille de bronze";
        document.getElementById("rank").innerText = "Bronze";
        recompense.appendChild(img);
      }
    } else {
      console.log("Error");
    }
  }
  async function getPlayers2() {
  console.log('loading players');
  const token = localStorage.getItem('token').toString();

  const response = await fetch('http://' + localHostOrUrl + ':8000/api/game/user', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify({ token })
  });

  if (response.ok) {
      const players = await response.json();
      console.log("players : ", players);
      const playerList = [];

      for (let i = 0; i < players.length; i++) {
          const player = players[i];
          playerList.push(player);
      }
      console.log("playerList : ", playerList)

      return playerList;
  } else {
      console.log('Failed to retrieve players');
      return [];
  }
}

async function displayPlayersRanking() {
  const players = await getPlayers2();
  players.sort((a, b) => b.score - a.score); // Tri des joueurs par score décroissant
  const playerList = document.createElement('ol'); // Création d'une liste ordonnée pour afficher les joueurs

  players.map((player, index) => {
      const listItem = document.createElement('li');
      listItem.textContent = `${index + 1}. ${player.username} - ${player.score} points`;
      playerList.appendChild(listItem);
  });

  const rankingContainer = document.getElementById('ranking-container'); 
  rankingContainer.appendChild(playerList);
}

//displayPlayersRanking();

  window.addEventListener("load", getData);
  window.addEventListener("load", displayPlayersRanking);
</script>



</body>
</html>